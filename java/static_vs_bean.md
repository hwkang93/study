> 항상 느끼는 거지만, 내가 아무리 쓸데없는 궁금한 게 생기더라도(개인적인 생각) 누군가는 나와 같은 고민을 하고,
> 그 결과를 공유하고 있다는 게 놀랍다.

# Static 함수 모음 Class 와 Spring Bean 객체에 대하여

API 관련 모듈을 만들던 중, Key 를 생성하는 ```ApiKeyGenerator``` 클래스를 만들어야 했다. 처음에는 별 생각 없이 ```static``` 클래스로 만들었는데,
구현 중 문득 궁금한 점이 생겼다.

**Spring Bean 으로 관리하는 건 어떨까?**

그동안의 경험으로 미루어보았을 때, 유틸리티 메소드가 모여있는 클래스의 경우 해당 클래스의 메소드들은 ```static``` 으로 선언하고 사용했다.
하지만 경험은 그저 경험일 뿐 정확한 기준이 아니었기 때문에, 정확한 기준을 정하고 그 기준에 따라```static``` 클래스와 Spring Bean 객체를 구분해 사용하기로 했다.
구글링을 시작했고 언제나 그랬듯 나와 같은 고민을 하신 분이 계셨다. 
그리고 명쾌한 기준을 제시해주셨는데, 그 기준은 아래와 같다. 

**"모든 함수의 인자가 동일할 경우 항상 동일한 결과를 리턴해야 한다." 의 조건을 충족하면 static 클래스로 생성한다.**
**그 외의 경우는 Spring Bean 으로 생성하고 관리한다.**

**이것이 이뤄지려면 함수 안에서는 외부 자원(Resource)에 대해 하나도 의존하면 안된다는 선결 조건을 충족해야 한다. 외부 자원은 그 실행 결과의 일관성을 보장할 수 없기 때문이다.**

모든 함수의 인자가 동일할 경우 항상 동일한 결과를 리턴해야 한다는 기준에 적절한 예시로 ```java.util.Arrays```, 
```org.springframework.util.CollectionUtils```, ```org.springframework.util.StringUtils``` 가 있다.
예를 들어 ```org.springframework.util.StringUtils``` 의 ```isEmpty()``` 메소드는 어느 상황에서도, 어떠한 경우에도 외부 환경과 상관없이
동일한 매개변수에 대해 같은 결과를 리턴한다.

애매한 상황에서의 기준을 잡는 법도 예시를 들어주셨는데,
- 설정 값(properties 파일 등에 정의된)을 참조하는 경우 외부 자원에 의존한다고 판단하며, 그 자원에 따라 결과가 달라지는 경우는 Spring Bean 객체로 관리한다.
- 메소드 내에서 다른 서버 등을 호출하는 경우도 당연히 외부 자원에 의존하는 것이며, 서버의 상태의 일관성을 보장하지 않기 때문에 이러한 메소드를 가진 클래스는 Spring Bean 객체로 관리한다.
- 외부 자원을 의존하는 객체를 파라미터로 받는 경우는 static 메소드로 만들 수 있다.

    (이 경우 메소드가 외부 자원에 의존하는 것이 아니고 매개변수 객체가 외부 자원에 의존하는 것이므로)




결과적으로 ```ApiKeyGenerator``` 클래스는 Spring Bean 객체로 변경하였다.
Key 를 만들 때 변수를 하나 참조하는데 그 변수는 ```private final``` 로 선언된 변수이긴 하지만 
그 변수의 참조값이 ```properties``` 파일에 정의되어 있으므로 외부 자원에 의존한다고 판단기 때문이다.

```java
@Component
public class ApiKeyGenerator {
    
    @Value("${api.salt}")
    private final String salt;
    
    public String createBy(final String email) {
        //키 만드는 로직
    }
    
    //...
}
```

```static``` 영역은 객체를 참조하는 형태가 아닌 직접 메소드를 실행하기 때문에 속도적인 장점이 있지만,
```heap``` 영역에 비해 메모리의 절대량이 작기 때문에 무분별한 사용은 지양해야 한다. 
그러므로 정확한 기준을 만들고 그 기준에 맞게 사용하는 습관을 기르자.

더불어 아무런 고민도 확신도 없이 ```ApiKeyGenerator``` 클래스를 만들었던 그 때를 반성하자. 






## Reference

[참고 블로그](http://kwon37xi.egloos.com/4844149)