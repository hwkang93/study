# MVC (Model View Controller)

소프트웨어 설계에 사용하는 디자인 패턴으로, MVC 는 Model, View, Controller 의 약자이다.
각 계층은 역할과 책임이 분명해야 하고 서로 독립적이어야 하며, 서로 다른 계층에 대해 최소한의 의존성만 가지고 있어야 한다.

## MVC 패턴의 장단점

### 장점

- 계층 별로 독립적인 개발이 가능하다.
  - 백엔드와 프론트엔드가 동시에 개발이 가능하다.
  - 계층 별 전문성이 향상된다.
- 계층 별 책임 영역이 명확해지기 때문에 높은 응집도를 가지게 된다.

### 단점

- 코드의 전체적인 처리 과정을 이해해야 하기 때문에 런닝 커브가 존재한다.
- 계층들이 갖는 책임에 대해 일관성을 유지해야 한다.

## Model, View, Controller

MVC 패턴은 Model, View, Controller 의 약자이다. 각 계층에 대해 정리해보자. 

### Model

데이터와 관련된 책임을 갖는 계층이다. 
Model 계층에서는 비즈니스 로직을 수행하고, 상태 변화를 처리한다.
데이터와 행동을 갖는 객체이다.
Model 계층은 Controller, View 계층에 의존해서는 안되며 오로지 데이터와 관련된 책임만 담당해야 한다.

### View

사용자에게 보일 화면(인터페이스)과 관련된 책임을 갖는 계층이다.
웹 어플리케이션에서는 사용자에게 보여지는 화면이 바로 View 이다.

View 계층은 Controller 계층과만 의존성을 가져야 하며, 데이터 및 로직과 관련된 책임(Model 계층의 책임)은 갖지 않아야 한다.

### Controller

Model 계층과 View 계층을 잇는 중개자.
View 계층에서의 요청을 Model 계층으로 전달하며, Model 계층에서 반환된 응답을 View 계층으로 전달해주는 역할을 한다.





## MVC 패턴에서의 5가지 계층

MVC 패턴은 시간이 지남에 따라 어플리케이션의 크기도 커지고, 복잡도도 증가해서 5가지 계층으로 세분화된다.

5계층의 MVC 패턴은 다음과 같다.

- 프레젠테이션 계층 (Presentation Layer)
- 제어 계층 (Control Layer)
- 비즈니스 로직 계층 (Business Logic Layer)
- 퍼시스턴스 계층 (Persistence Layer)
- 도메인 모델 계층 (Domain Model Layer)

좋은 블로그의 글을 빌려 하나씩 정리해보자.

### 프레젠테이션 계층 (Presentation Layer)

사용자 인터페이스(화면 등)를 제공하는 계층

사용자가 선택할 수 있는 기능이 표시되어 있어야 하고, 요청에 필요한 부가적인 정보 전달을 위한 입력 양식이 있어야 한다.
또한 전달된 자료를 효과적으로 보여주기 위한 프레젠테이션 로직이 포함된다. 하지만 비즈니스 로직이나 퍼시스턴스 계층에서 처리하는 일을
직접 수행하거나, 각 계층의 컴포넌트와 직접적인 통신이 있어서는 안된다.

모든 요청은 제어 계층을 통해 처리되어야 한다는 뜻이다.
고급 레스토랑(엔터프라이즈 시스템)에서는 웨이터(지배인)을 통해서만 요구를 전달하고, 그 결과를 전해들어야 한다.
직접 주방장에게 주문을 하거나 자기가 직접 요리를 하는 것은 자기 집(프로토타입)이나 동네 자장면 가게(소규모 웹 어플리케이션)에서나 가능한 일디ㅏ.

- 주요 패턴 : Composite View 패턴

### 제어 계층 (Control Layer)

프레젠테이션 계층과 비즈니스 로직 계층을 분리하기 위해 존재하는 계층

전체 시스템의 설정 상태를 유지해야 하며, 그를 통해 어떤 요청이 들어왔을 때 어떤 로직이 처리해야 하는 지를 결정한다.
사용자의 요청을 검증하고 로직에 요청을 전달하는 일과 로직에서 전달된 응답을 적절한 뷰에 연결짓는 것 역시 제어 계층의 몫이다.

- 주요 패턴 : Front Controller 패턴, Service to Worker 패턴, Intercepting Filter 패턴, Application Controller & Context Object 패턴

### 비즈니스 로직 계층 (Business Logic Layer)

핵심 업무를 어떻게 처리하는지에 대한 방법을 기술하는 계층

비즈니스 로직에는 핵심 업무 로직의 구현과 그에 관련된 데이터의 적합성 검증 외에도 다양한 부가적인 구현이 추가된다.
트랜잭션 처리라던지 다른 계층들과 통신하기 위한 인터페이스를 제공한다거나, 해당 계층의 객체들 간의 관계를 관리하는 것 등이 그것이다.


- 주요 패턴 : Business Delegate 패턴, Session Facade 패턴, Service Locator 패턴, Application Service 패턴, EJB Home Factory 패턴

### 퍼시스턴스 계층 (Persistence Layer)

데이터 처리를 담당하는 계층

관계형 정보를 저장하고, 수정/삭제하는 것과 그러한 일을 수행하는 데 필요한 질의문(예를 들면 쿼리)을 관리하는 것
그리고 가져온 관계형 정보를 객체화시키는 일

- 주요 패턴 : Data Access Object 패턴, Domain Store 패턴, Sequence Blocks

> 데이터 처리는 주로 데이터베이스에서 처리되는 경우가 많아 영속성을 의미하는 Persistence 라는 용어를 사용했다.
> 하지만 데이터가 처리되는 다른 업무 시스템이나, 웹 서비스, XML, 파일 시스템 등을 모두 고려한다면 레거시 개념을 갖는 EIS 계층이란 표현이 더 적합할 것이다.

### 도메인 모델 계층 (Domain Model Layer)

각 계층 사이에 전달되는 실질적인 비즈니스 객체

도메인 모델 계층은 흔히 데이터 전송 객체(DTO) 형태로 개발자가 직접 제작해서, 리퀘스트나 세션과 같은 컨텍스트에 담아 넘기게 된다.

- 주요 패턴 : Data Transfer Object 패턴, Value List Handler 패턴


## 예시를 통해 MVC 패턴 이해하기

MVC 패턴은 실제 사회에서 어떤 목적을 수행하는 방식과 메커니즘이 유사하다.
예시를 하나 들텐데, 다음 예시는 레스토랑에서 음식을 주문하는 과정을 글로 풀어 쓴 것이다. 

> 손님이 레스토랑에 도착했다. 자리에 앉아 메뉴판을 보고 종업원을 불러 메뉴를 주문한다.
>
> 메뉴를 주문받은 종업원은 요리사에게 메뉴를 전달한다.
>
> 요리사는 메뉴를 확인한다. 그리고 냉장고에서 재료를 꺼내 요리를 만든다.
>
> 만들어진 요리는 요리의 특색에 맞는 그릇에 담긴다. 파스타는 그릇에 피자는 접시에.
>
> 요리사는 만들어진 요리를 종업원에게 전달한다.
>
> 종업원은 요리사에게 받은 요리를 손님에게 전달한다.

예시에 나오는 것들은 역할이 정해져 있다.

주문을 하고 음식을 받는 손님,
손님에게 주문받아 요리사에게 전달하는 종업원,
요리를 하고 완성된 요리를 손님에게 제공하는 요리사,
요리를 담는 그릇.
모두 본인이 해야 하는 역할과 역할에 맞는 책임을 가지고 있다.

여기서 **각 역할들은 역할과 책임이 분명해야 하고 독립적이어야 한다.**
예시에서의 손님, 요리사, 종업원은 역할과 책임이 분명하고 독립적이다. 
손님은 요리사가 어떻게 요리를 만들고 있는지, 어떠한 재료를 사용하고 있는지 알지 못한다. 그저 종업원에게 메뉴를 주문하고, 완성된 메뉴를 받기만 하면 된다.
요리사도 마찬가지이다. 손님이 누구인지, 몇 명이 왔는지, 왜 이 요리를 주문한 건지 알지 못한다. 주문이 들어온 대로 요리를 만들어주기만 하면 된다.
종업원은 손님에게 주문받은 요리를 요리사에게 전달하고, 완성된 요리를 다시 손님에게 가져다 주는 역할만 수행하면 된다.

각 역할들은 독립적일수록 대체하기가 쉬워진다.
예를 들어, 요리사는 메뉴에 있는 요리를 하는 역할만 가지고 있어야 다른 요리사로 대체되었을 때 그 식당이 운영되는 데에 문제가 없다.
손님에게 주문받은 요리를 요리사에게 전달하고, 완성된 요리를 다시 손님에게 가져다 주는 역할을 수행할 수만 있다면 종업원은 언제든 대체될 수 있다.

그리고 각 역할들은 독립적으로도 충분한 가치를 지니고 있지만 올바른 위치에 있어야 한다.
가장 장점을 발휘하는 위치에서 서로 연계되어 사용될 때 그 시너지 효과가 더욱 크다.

이러한 것들은 MVC 패턴에서도 그대로 적용된다.
손님은 **View** 로 볼 수 있고 종업원은 **Controller** 로 볼 수 있다.
그리고 요리사가 종업원에게 주문을 받아 주문에 맞는 재료를 꺼내 요리를 하고 완성된 요리를 접시에 담아 다시 종업원에게 전달하는 과정이 **Model** 이다.

위의 예시는 앞서 설명한 MVC 패턴의 5가지 계층으로도 구분할 수 있다.

Model 계층 에서 '요리사가 종업원에게 주문을 받아 주문에 맞는 재료를 꺼내 요리를 하고 완성된 요리를 접시에 담아 다시 종업원에게 전달하는 과정' 은
**재료를 Persistence Layer, 요리하는 과정을 Business Logic Layer, 접시를 Domain Layer** 로 다시 구분할 수 있다.

정리하자면 다음과 같이 구분할 수 있겠다. 

- **Presentation Layer** : 손님
- **Control Layer** : 종업원
- **Business Logic Layer** : 요리사가 요리하는 과정
- **Persistence Layer** : 재료
- **Domain Model Layer** : 그릇


## 마치며

MVC 패턴은 어플리케이션이 정상적이고 안정적으로 역할을 수행하기 위해 갖추고 있어야 할 역할들을 명확하게 구분해서 정의한 패턴이라고 생각한다.
그리고 MVC 패턴을 사용하는 개발자들은 패턴의 목적에 맞게 계층들을 구분하고 사용해야 한다.
더 나은 어플리케이션을 만들 수 있을 것이다.

MVC 패턴을 공부하며 오랜 시간동안 겪었을 과거의 많은 개발자들의 시행착오와 그 시행착오를 개선하기 위한 그 분들의 노력을 조금이나마 느낄 수 있었다.
좋은 어플리케이션을 위해 이러한 이론을 적립해주신 과거의 개발자들에게 감사하며
나도 후배들에게 내가 겪었던 시행착오를 반복하지 않을 수 있도록 도움을 주고 싶다.



## Reference

[[오픈소스를 이용한 시스템 통합] ③ 오픈소스 프레임.. - 마이다스](http://egloos.zum.com/mt1716/v/9291203)

[우아한 테크 -MVC 패턴 리뷰- [레이어, MVC 패턴, 5레이어] - Murphy](https://murphymoon.tistory.com/entry/%EC%9A%B0%EC%95%84%ED%95%9C-%ED%85%8C%ED%81%AC-MVC-%EB%A6%AC%EB%B7%B0-%EB%A0%88%EC%9D%B4%EC%96%B4-MVC-%ED%8C%A8%ED%84%B4-5%EB%A0%88%EC%9D%B4%EC%96%B4)